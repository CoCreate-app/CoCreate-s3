!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreate=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.socket=t())}(this,(function(){return e={212:function(e,t){var o;"undefined"!=typeof self&&self,void 0===(o=function(){return function(e){const t={attribute:"data-uuid",init:function(t){if(!e.document)return;const o=t||e.document;if(!o.querySelectorAll)return;let n=o.querySelectorAll(`[${this.attribute}]`);const s=this;n.forEach((e=>{const t=parseInt(e.getAttribute(s.attribute))||36,o=s.generate(t);"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value=o:e.innerHTML=o}))},generate:function(t=36){let o=(new Date).getTime(),n=e.performance&&e.performance.now&&1e3*e.performance.now()||0,s="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(t<=s.length)s=s.substr(0,t);else{let e=t-s.length,o="-xxxyyxxx",n=Math.floor(e/o.length);for(let e=0;e<n;e++)s+=o;n=e-n*o.length,s+=o.substr(0,n)}return s.replace(/[xy]/g,(function(e){var t=16*Math.random();return o>0?(t=(o+t)%16|0,o=Math.floor(o/16)):(t=(n+t)%16|0,n=Math.floor(n/16)),("x"==e?t:7&t|8).toString(16)}))}};return t.init(),t}(window)}.apply(t,[]))||(e.exports=o)},32:(e,t)=>{"use strict";var o;"undefined"!=typeof self&&self,void 0===(o=function(){return function(e){function t(){let t={};return e&&e.config&&(t=e.config),{apiKey:t.apiKey,organization_id:t.organization_Id}}function o(t){let o={};return e&&e.config&&(o=e.config),{apiKey:t.apiKey||o.apiKey,organization_id:t.organization_id||o.organization_Id}}function n(t,o){let n={};e&&e.config&&(n=e.config);let s=t||n.organization_Id,i=o||"";return i?`${s}/${i}`:s}return{getCommonParams:t,getCommonParamsExtend:o,generateSocketClient:n}}(window)}.apply(t,[]))||(e.exports=o)},352:(e,t,o)=>{"use strict";var n,s;"undefined"!=typeof self&&self,n=[o(32),o(212)],void 0===(s=function(e,t){return function(e,t,o,n,s){class i{constructor(e="crud"){this.prefix=e||"crud",this.sockets=new Map,this.listeners=new Map,this.messageQueue=new Map,this.saveFileName="",this.globalScope=""}setGlobalScope(e){this.globalScope=`${this.prefix}/${e}`}getGlobalScope(){return this.globalScope}create(e){const{namespace:s,room:i}=e,r=this.getKey(s,i);let a,c=this;if(s&&this.setGlobalScope(s),this.sockets.get(r))return void(a=this.sockets.get(r));let l=t.location.protocol;"about:"===t.location.protocol&&(l=t.parent.location.protocol,e.host||(e.host=t.parent.location.host));let u="http:"===l?"ws":"wss";const d=e.port?e.port:8088;let f=`${u}://${t.location.host}:${d}/${r}`;e.host&&(f=e.host.includes("://")?`${e.host}/${r}`:e.host.includes(":")?`${u}://${e.host}/${r}`:`${u}://${e.host}:${d}/${r}`);try{let e=null;t.localStorage&&(e=t.localStorage.getItem("token")),a=new o(f,e),a.cocreate_connected=!1,this.sockets.set(r,a)}catch(e){return}a.onopen=function(e){a.cocreate_connected||(a.cocreate_connected=!0),(c.messageQueue.get(r)||[]).forEach((e=>a.send(JSON.stringify(e)))),c.messageQueue.set(r,[])},a.onclose=function(t){switch(t.code){case 1e3:break;default:c.destroy(a,r),c.reconnect(a,e)}},a.onerror=function(t){c.destroy(a,r),c.reconnect(a,e)},a.onmessage=function(e){try{if(t.Blob&&e.data instanceof n)return void c.saveFile(e.data);let o=JSON.parse(e.data);if(o.data&&(o.data.uid&&c.__fireEvent(o.data.uid,o.data),o.data.event))return void c.__fireEvent(o.data.event,o.data);o.action;const s=c.listeners.get(o.action);if(!s)return;s.forEach((e=>{e(o.data,r)}))}catch(e){}}}__fireEvent(e,o){if(t.CustomEvent){var n=new t.CustomEvent(e,{detail:o});t.document.dispatchEvent(n)}else process.emit(e,o)}send(e,t,o){const n=s.generate(),i={action:e,data:{...t,uid:n}},r=this.getKeyByRoom(o),a=this.getByRoom(o);return a&&a.cocreate_connected?a.send(JSON.stringify(i)):this.messageQueue.get(r)?this.messageQueue.get(r).push(i):this.messageQueue.set(r,[i]),n}sendFile(e,t){const o=this.getByRoom(t);o&&o.send(e)}listen(e,t){this.listeners.get(e)?this.listeners.get(e).push(t):this.listeners.set(e,[t])}reconnect(e,t){let o=this;setTimeout((function(){o.create(t)}),1e3)}destroy(e,t){e&&(e.onerror=e.onopen=e.onclose=null,e.close(),e=null),this.sockets.get(t)&&this.sockets.delete(t)}destroyByKey(e){let t=this.sockets.get(e);t&&this.destroy(t,e)}getKey(e,t){let o=`${this.prefix}`;return e&&""!=e&&(o+=t&&""!=t?`/${e}/${t}`:`/${e}`),o}getByRoom(e){let t=this.getKeyByRoom(e);return this.sockets.get(t)}getKeyByRoom(e){let t=this.globalScope;return e&&(t=`${this.prefix}/${e}`),t}saveFile(e){if(t.document){const n=this.saveFileName||"downloadFile";var o=t.document.createElement("a");t.document.body.appendChild(o),o.style="display: none";let s=window.URL.createObjectURL(e);o.href=s,o.download=n,o.click(),t.URL.revokeObjectURL(s),this.saveFileName=""}}listenAsync(e){return new Promise(((o,n)=>{let s=setTimeout((()=>{clearTimeout(s),o(null)}),5e3);t.document?t.document.addEventListener(e,(function(e){o(e.detail)}),{once:!0}):process.once(e,(e=>{o(e)}))}))}}return i}(0,window,WebSocket,Blob,t)}.apply(t,n))||(e.exports=s)}},t={},function o(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}(352).default;var e,t}));