!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CoCreate=t():(e.CoCreate=e.CoCreate||{},e.CoCreate.crud=t())}(this,(function(){return e={446:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(e){function t(){let t={};return e&&e.config&&(t=e.config),{apiKey:t.apiKey,organization_id:t.organization_Id}}function n(t){let n={};return e&&e.config&&(n=e.config),{apiKey:t.apiKey||n.apiKey,organization_id:t.organization_id||n.organization_Id}}function o(t,n){let o={};e&&e.config&&(o=e.config);let r=t||o.organization_Id,a=n||"";return a?`${r}/${a}`:r}return{getCommonParams:t,getCommonParamsExtend:n,generateSocketClient:o}}(window)}.apply(t,[]))||(e.exports=n)},585:function(e,t,n){var o,r;"undefined"!=typeof self&&self,o=[n(446),n(212)],void 0===(r=function(e,t){return function(e,t,n,o,r){class a{constructor(e="crud"){this.prefix=e||"crud",this.sockets=new Map,this.listeners=new Map,this.messageQueue=new Map,this.saveFileName="",this.globalScope=""}setGlobalScope(e){this.globalScope=`${this.prefix}/${e}`}getGlobalScope(){return this.globalScope}create(e){const{namespace:r,room:a}=e,i=this.getKey(r,a);let s,c=this;if(r&&this.setGlobalScope(r),this.sockets.get(i))return void(s=this.sockets.get(i));let l=t.location.protocol;"about:"===t.location.protocol&&(l=t.parent.location.protocol,e.host||(e.host=t.parent.location.host));let u="http:"===l?"ws":"wss";const d=e.port?e.port:8088;let f=`${u}://${t.location.host}:${d}/${i}`;e.host&&(f=e.host.includes("://")?`${e.host}/${i}`:e.host.includes(":")?`${u}://${e.host}/${i}`:`${u}://${e.host}:${d}/${i}`);try{let e=null;t.localStorage&&(e=t.localStorage.getItem("token")),s=new n(f,e),s.cocreate_connected=!1,this.sockets.set(i,s)}catch(e){return}s.onopen=function(e){s.cocreate_connected||(s.cocreate_connected=!0),(c.messageQueue.get(i)||[]).forEach((e=>s.send(JSON.stringify(e)))),c.messageQueue.set(i,[])},s.onclose=function(t){switch(t.code){case 1e3:break;default:c.destroy(s,i),c.reconnect(s,e)}},s.onerror=function(t){c.destroy(s,i),c.reconnect(s,e)},s.onmessage=function(e){try{if(t.Blob&&e.data instanceof o)return void c.saveFile(e.data);let n=JSON.parse(e.data);if(n.data&&(n.data.uid&&c.__fireEvent(n.data.uid,n.data),n.data.event))return void c.__fireEvent(n.data.event,n.data);n.action;const r=c.listeners.get(n.action);if(!r)return;r.forEach((e=>{e(n.data,i)}))}catch(e){}}}__fireEvent(e,n){if(t.CustomEvent){var o=new t.CustomEvent(e,{detail:n});t.document.dispatchEvent(o)}else process.emit(e,n)}send(e,t,n){const o=r.generate(),a={action:e,data:{...t,uid:o}},i=this.getKeyByRoom(n),s=this.getByRoom(n);return s&&s.cocreate_connected?s.send(JSON.stringify(a)):this.messageQueue.get(i)?this.messageQueue.get(i).push(a):this.messageQueue.set(i,[a]),o}sendFile(e,t){const n=this.getByRoom(t);n&&n.send(e)}listen(e,t){this.listeners.get(e)?this.listeners.get(e).push(t):this.listeners.set(e,[t])}reconnect(e,t){let n=this;setTimeout((function(){n.create(t)}),1e3)}destroy(e,t){e&&(e.onerror=e.onopen=e.onclose=null,e.close(),e=null),this.sockets.get(t)&&this.sockets.delete(t)}destroyByKey(e){let t=this.sockets.get(e);t&&this.destroy(t,e)}getKey(e,t){let n=`${this.prefix}`;return e&&""!=e&&(n+=t&&""!=t?`/${e}/${t}`:`/${e}`),n}getByRoom(e){let t=this.getKeyByRoom(e);return this.sockets.get(t)}getKeyByRoom(e){let t=this.globalScope;return e&&(t=`${this.prefix}/${e}`),t}saveFile(e){if(t.document){const o=this.saveFileName||"downloadFile";var n=t.document.createElement("a");t.document.body.appendChild(n),n.style="display: none";let r=window.URL.createObjectURL(e);n.href=r,n.download=o,n.click(),t.URL.revokeObjectURL(r),this.saveFileName=""}}listenAsync(e){return new Promise(((n,o)=>{let r=setTimeout((()=>{clearTimeout(r),n(null)}),5e3);t.document?t.document.addEventListener(e,(function(e){n(e.detail)}),{once:!0}):process.once(e,(e=>{n(e)}))}))}}return a}(0,window,WebSocket,Blob,t)}.apply(t,o))||(e.exports=r)},212:function(e,t){var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(e){const t={attribute:"data-uuid",init:function(t){if(!e.document)return;const n=t||e.document;if(!n.querySelectorAll)return;let o=n.querySelectorAll(`[${this.attribute}]`);const r=this;o.forEach((e=>{const t=parseInt(e.getAttribute(r.attribute))||36,n=r.generate(t);"INPUT"===e.tagName||"TEXTAREA"===e.tagName?e.value=n:e.innerHTML=n}))},generate:function(t=36){let n=(new Date).getTime(),o=e.performance&&e.performance.now&&1e3*e.performance.now()||0,r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";if(t<=r.length)r=r.substr(0,t);else{let e=t-r.length,n="-xxxyyxxx",o=Math.floor(e/n.length);for(let e=0;e<o;e++)r+=n;o=e-o*n.length,r+=n.substr(0,o)}return r.replace(/[xy]/g,(function(e){var t=16*Math.random();return n>0?(t=(n+t)%16|0,n=Math.floor(n/16)):(t=(o+t)%16|0,o=Math.floor(o/16)),("x"==e?t:7&t|8).toString(16)}))}};return t.init(),t}(window)}.apply(t,[]))||(e.exports=n)},381:(e,t,n)=>{"use strict";var o,r;"undefined"!=typeof self&&self,o=[n(446),n(158)],void 0===(r=function(e,t){return function(e,t,n){return{socket:null,setSocket:function(e){this.socket=e},readDocumentList:async function(e){if(!e)return!1;let n=t.getCommonParams();if(!e.collection)return!1;n={...n,...e},t.generateSocketClient(e.namespace,e.room);const o=this.socket.send("readDocumentList",n);try{return await this.socket.listenAsync(o)}catch(e){return null}},createDocument:async function(n){if(null===n)return!1;let o=t.getCommonParamsExtend(n),r={...n,...o},a=n.data||{};a.organization_id||(a.organization_id=e.config.organization_Id),n.data&&(a={...a,...n.data}),r.data=a;const i=t.generateSocketClient(n.namespace,n.room);let s=this.socket.send("createDocument",r,i);try{return await this.socket.listenAsync(s)}catch(e){return null}},updateDocument:async function(e){if(!e)return!1;if(e.document_id&&!n.checkDocumentId(e.document_id))return!1;let o=t.getCommonParamsExtend(e),r={...e,...o};if("object"==typeof e.data&&(r.set=e.data),Array.isArray(e.delete_fields)&&(r.unset=e.delete_fields),!r.set&&!r.unset)return!1;!1===e.broadcast&&(r.broadcast=!1),void 0===e.broadcast_sender&&(r.broadcast_sender=!0);const a=t.generateSocketClient(e.namespace,e.room);let i=this.socket.send("updateDocument",r,a);try{return await this.socket.listenAsync(i)}catch(e){return null}},readDocument:async function(e){if(null===e)return null;if(!e||!n.checkDocumentId(e.document_id))return null;let o=t.getCommonParamsExtend(e),r={...e,...o},a=this.socket.send("readDocument",r);try{return t.generateSocketClient(e.namespace,e.room),await this.socket.listenAsync(a)}catch(e){return null}},deleteDocument:async function(e){if(!e||!n.checkDocumentId(e.document_id))return null;let o=t.getCommonParamsExtend(e),r={...e,...o};const a=t.generateSocketClient(e.namespace,e.room);let i=this.socket.send("deleteDocument",r,a);try{return await this.socket.listenAsync(i)}catch(e){return null}},exportCollection:function(e){if(null===e)return;let n=t.getCommonParamsExtend(e);n.collection=e.collection,n.export_type=e.export_type,n.metadata=e.metadata,this.socket.send("exportDB",n)},importCollection:function(n){const{file:o}=n;if(null===n||!(o instanceof e.File))return;const r=o.name.split(".").pop();if(!["json","csv"].some((e=>e===r)))return;let a=t.getCommonParamsExtend(n);a.collection=n.collection,a.import_type=r,this.socket.send("importDB",a),this.socket.sendFile(o)},listen:function(e,t){this.socket.listen(e,t)},listenAsync:function(e){return this.socket.listenAsync(e)},createSocket:function(e,t){t?(this.socket.create({namespace:t,room:null,host:e}),this.socket.setGlobalScope(t)):this.socket.create({namespace:null,room:null,host:e})},read:async function(e,t){const{collection:o,document_id:r,name:a,namespace:i,room:s,is_read:c}=n.getAttr(e);return!1!==t&&(t=!0),n.isJsonString(o)||n.isJsonString(r)?null:r&&o&&c?await this.readDocument({namespace:i,room:s,collection:o,document_id:r,name:a,is_flat:t}):null},save:async function(e){if(e)for(let t=0;t<e.length;t++)await this.saveElement(e[t])},saveElement:async function({element:t,value:o,is_flat:r}){if(!t||null===o)return;const{collection:a,document_id:i,name:s,namespace:c,room:l,broadcast:u,broadcast_sender:d,is_save:f}=n.getAttr(t);if(f&&a&&s)if(n.isCRDT(t)&&e.CoCreate.crdt)e.CoCreate.crdt.replaceText({collection:a,name:s,document_id:i,name:s,value:o});else{let e=await this.updateDocument({namespace:c,room:l,collection:a,document_id:i,upsert:!0,broadcast:u,broadcast_sender:d,is_flat:!1!==r,data:{[s]:o}});e.document_id&&i!==e.document_id&&await this.setDocumentId({element:t,docuement_id:e.document_id})}},setDocumentId:async function({element:e,form:t,document_id:n}){!t&&e&&(t=e.closest("form")),t?await CoCreate.form.setDocumentId(t):e&&e.setAttribute("data-document_id",n)},...n}}(window,e,t)}.apply(t,o))||(e.exports=r)},352:(e,t,n)=>{"use strict";var o,r;"undefined"!=typeof self&&self,o=[n(585),n(381)],void 0===(r=function(e,t){return function(e,t,n){if(e){let e=window.CoCreateCrudSocket;e||(e=new t("ws"),window.CoCreateCrudSocket=e),n.setSocket(e),n.createSocket(window.config.host?window.config.host:window.location.hostname,window.config.organization_Id)}return n}(!0,e,t)}.apply(t,o))||(e.exports=r)},158:(e,t)=>{"use strict";var n;"undefined"!=typeof self&&self,void 0===(n=function(){return function(){function e(t,n){t=t||{};for(let o of Object.keys(n))n[o]instanceof Object&&Object.assign(n[o],e(t[o],n[o]));return Object.assign(t||{},n),t}function t(e,t){if(!t)return e;let n=t.split("."),o=e;for(var r=n.length-1;r>=0;r--)o={[n[r]]:o};return o}function n(e,t){try{let n=/([\w\W]+)\[(\d+)\]/gm.exec(e);if(n&&3==n.length){let o=n[1],r=parseInt(n[2]);t[o]&&Array.isArray(t[o])||(t[o]=[]),t[o][r]=t[e],delete t[e],e=o}}catch{}return e}function o(e,t){try{if(!e||!t)return null;if(t[e])return t[e];let o=e.split("."),r={...t};for(var n=0;n<o.length&&r;n++)r=r[o[n]];return r}catch{return null}}function r(e){return!!e&&e.constructor===Object}function a(e){return!!e&&e.constructor===Array}function i(o){let r=Object.keys(o),a={};return r.forEach((r=>{if((r=n(r,o)).split(".").length>1){let n=t(o[r],r);delete o[r],a=e(a,n)}else a[r]=o[r]})),a}function s(e){let t=Object.keys(e),n={};return t.forEach((t=>{let o=e[t];if(r(e[t])){let o=s(e[t]);Object.keys(o).forEach((e=>{let r=o[e];n[e=t+"."+e]=r}))}else a(o)?o.forEach(((e,o)=>{n[`${t}[${o}]`]=e})):n[t]=e[t]})),n}function c(e){if(!e)return;let t=e.getAttribute("data-collection"),n=e.getAttribute("data-document_id"),o=e.getAttribute("name"),r=e.getAttribute("data-room");return{collection:t,document_id:n,name:o,is_realtime:h(e),is_save:u(e),is_read:l(e),is_update:d(e),is_listen:p(e),broadcast:f(e),broadcast_sender:m(e),room:r}}const l=e=>g(e,"data-read_value"),u=e=>g(e,"data-save_value"),d=e=>g(e,"data-update_value"),f=e=>g(e,"data-broadcast"),m=e=>g(e,"data-broadcast_sender"),p=e=>g(e,"data-listen"),h=e=>!!e&&"false"!=e.getAttribute("data-realtime");function g(e,t){return!!e&&"false"!==e.getAttribute(t)}function y(e){return!!e&&!/{{\s*([\w\W]+)\s*}}/g.test(e)}function x(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!=t}catch(e){return!1}}function _(e){const{collection:t,document_id:n,name:o}=c(e);return!(x(t)||x(o)||!("INPUT"===e.tagName&&["text","email","tel","url"].includes(e.type)||"TEXTAREA"===e.tagName)||!o||!h(e)||"true"===e.getAttribute("data-unique")||"password"===e.type||!l(e))}function b(e){try{return!!e&&"null"!==e.toLowerCase()}catch(e){return!1}}function x(e){try{let t=JSON.parse(e);return"object"==typeof t&&null!=t}catch(e){return!1}}return{decodeObject:i,encodeObject:s,getAttr:c,isRealtimeAttr:h,isReadAttr:l,isSaveAttr:u,isUpdateAttr:d,isFlatAttr:e=>g(e,"data-flat"),checkAttrValue:y,isCRDT:_,checkDocumentId:b,getValueByPath:o,isJsonString:x}}()}.apply(t,[]))||(e.exports=n)}},t={},function n(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,n),a.exports}(352).default;var e,t}));